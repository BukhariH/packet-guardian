{{define "manage"}}
{{template "header" dict "css" (list "manage") "main" . "pageTitle" "Device Management"}}
<div class="manager">
    <form>
        <input type="hidden" name="username" value="{{.sessionUser.Username}}">
        <div class="info">
            <span class="text-label">Username:</span>
            <span class="username">{{.sessionUser.Username}}</span>
            {{if .sessionUser.IsBlacklisted}}<span class="blacklist-icon">Blacklisted</span>{{end}}
        </div>
        <div class="info">
            <span class="text-label"># of Devices:</span>
            <span class="username">{{len .devices}}</span>
        </div>
        <div class="controls">
            {{if .showAddBtn}}
            <button type="button" name="add-device-btn">Add New Device</button>
            {{end}}
            {{if and .canDeleteDevice (gt (len .devices) 0)}}
            <button type="button" name="del-selected-btn">Delete Selected</button>
            <button type="button" name="del-all-btn">Delete All</button>
            {{end}}
            <a href="/logout" class="btn">Logout</a>
        </div>
        {{if eq (len .devices) 0}}
        <div class="no-devices">No devices registered</div>
        {{else}}
        <table>
            <tr>
                <th><input type="checkbox" name="dev-sel-all"></th>
                <th>MAC Address</th>
                <th class="not-important">User Agent</th>
                <th>Description</th>
                <th>Platform</th>
                <th>Registered</th>
                <th>Expires</th>
                <th>Last Seen</th>
                <th>Registered From</th>
                <th>Current IP</th>
            </tr>
            {{range .devices}}
            <tr>
                <td><input type="checkbox" value="{{.MAC}}" class="device-select"></td>
                <td>{{if .IsBlacklisted}}<span class="blacklist-icon">&cross;</span>{{end}}{{.MAC}}</td>
                <td class="not-important truncate"><span title="{{.UserAgent}}">{{.UserAgent}}</span></td>
                <td class="truncate"><span title="{{.Description}}">{{.Description}}</span></td>
                <td>{{.Platform}}</td>
                <td>{{.DateRegistered.Format "2006-01-02 15:04"}}</td>

                {{if eq .Expires.Unix 0}}
                <td>Never</td>
                {{else if eq .Expires.Unix 1}}
                <td>Rolling</td>
                {{else}}
                <td>{{.Expires.Format "2006-01-02 15:04"}}</td>
                {{end}}

                <td>{{.LastSeen.Format "2006-01-02 15:04"}}</td>
                <td>{{.RegisteredFrom}}</td>

                {{with .GetCurrentLease}}
                <td><span title="Expires: {{.End.Format "2006-01-02 15:04"}}">{{.IP.String}}</span></td>
                {{else}}
                <td>N/A</td>
                {{end}}
            </tr>
            {{end}}
        </table>
        {{end}}
    </form>

    {{if gt (len .devices) 0}}
    <p>
        <span class="blacklist-icon">&cross;</span> = Blacklisted MAC address
    </p>
    {{end}}
</div>
{{template "footer" dict "js" (list "manage")}}
{{end}}
